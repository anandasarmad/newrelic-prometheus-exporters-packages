description: |
  End-to-end tests for Aerospike integration

scenarios:
  - description: |
      This scenario will verify that metrics from aerospike prometheus exporter are correcly collected.
    before:
      - docker-compose up -d
    after:
      - docker-compose down -v
    integrations:
      - name: nri-aerospike
        binary_path: ../target/bin/nri-aerospike
        exporter_binary_path: ../target/bin/aerospike-exporter
        config:
          aerospike_host: aerospike-server
          aerospike_port: 3000
          exporter_port: 9091
    tests:
      nrqls:
        - query: "FROM Metric SELECT count(*) WHERE job LIKE '%aerospike%' and metricName LIKE '%aerospike_node_ticks%' SINCE 1 week ago TIMESERIES"
      entities:
        - type: "AEROSPIKE_CLIENT_CONNECTIONS"
          data_type: "Metric"
          metric_name: "aerospike_node_ticks"
      metrics:
        - source: "aerospike.yml"
          except_entities:
            - AEROSPIKE_CLIENT_CONNECTIONS
          except_metrics:
            - aerospike_node_stats_client_connections_opened
            - aerospike_node_stats_client_connections_closed